{% extends "base.html" %}

{% block title %}{{ car.full_name }} - Aurora Motors{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>{{ car.full_name }}</h1>
        <p>Vehicle Details</p>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-8">
            <!-- Car Images -->
            <div class="card mb-4">
                <div class="card-body">
                    {% if car.main_image %}
                    <img src="{{ car.main_image }}" alt="{{ car.full_name }}" class="img-fluid rounded">
                    {% else %}
                    <div class="placeholder-image">
                        <i class="fas fa-car fa-5x text-muted"></i>
                        <p class="text-muted mt-3">No image available</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Car Details -->
            <div class="card">
                <div class="card-header">
                    <h3>Vehicle Information</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <h5>Basic Information</h5>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Make:</strong></td>
                                    <td>{{ car.make }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Model:</strong></td>
                                    <td>{{ car.model }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Year:</strong></td>
                                    <td>{{ car.year }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Category:</strong></td>
                                    <td>
                                        <span class="badge badge-info">{{ car.category.value }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Color:</strong></td>
                                    <td>{{ car.color or 'N/A' }}</td>
                                </tr>
                                <tr>
                                    <td><strong>License Plate:</strong></td>
                                    <td>{{ car.license_plate }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-6">
                            <h5>Specifications</h5>
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>Seats:</strong></td>
                                    <td>{{ car.seats }} passengers</td>
                                </tr>
                                <tr>
                                    <td><strong>Transmission:</strong></td>
                                    <td>{{ car.transmission }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Fuel Type:</strong></td>
                                    <td>{{ car.fuel_type }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Mileage:</strong></td>
                                    <td>{{ "{:,}".format(car.mileage) }} km</td>
                                </tr>
                                <tr>
                                    <td><strong>VIN:</strong></td>
                                    <td>{{ car.vin }}</td>
                                </tr>
                                <tr>
                                    <td><strong>Location:</strong></td>
                                    <td>{{ car.current_location }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    {% if car.features %}
                    <div class="mt-4">
                        <h5>Features</h5>
                        <div class="features-list">
                            {% for feature in car.features %}
                            <span class="badge badge-secondary me-2 mb-2">
                                <i class="fas fa-check-circle"></i> {{ feature }}
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    {% if car.description %}
                    <div class="mt-4">
                        <h5>Description</h5>
                        <p>{{ car.description }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            {% if current_user.is_authenticated and current_user.is_manager %}
            <!-- Recent Bookings (Admin Only) -->
            <div class="card mt-4">
                <div class="card-header">
                    <h3>Recent Bookings</h3>
                </div>
                <div class="card-body">
                    {% if recent_bookings %}
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Booking #</th>
                                    <th>Customer</th>
                                    <th>Dates</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for booking in recent_bookings %}
                                <tr>
                                    <td>{{ booking.booking_number }}</td>
                                    <td>{{ booking.customer.full_name }}</td>
                                    <td>
                                        {{ booking.pickup_date.strftime('%m/%d/%Y') }} - 
                                        {{ booking.return_date.strftime('%m/%d/%Y') }}
                                    </td>
                                    <td>
                                        <span class="badge badge-{{ booking.status_badge }}">
                                            {{ booking.status.value }}
                                        </span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('bookings.view', id=booking.id) }}" 
                                           class="btn btn-sm btn-outline-primary">View</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">No bookings yet for this vehicle.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-4">
            <!-- Pricing Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Rental Rates</h4>
                </div>
                <div class="card-body">
                    <div class="pricing-info">
                        <div class="price-item">
                            <span class="price-label">Daily Rate:</span>
                            <span class="price-value">${{ "%.2f"|format(car.daily_rate) }}</span>
                        </div>
                        {% if car.weekly_rate %}
                        <div class="price-item">
                            <span class="price-label">Weekly Rate:</span>
                            <span class="price-value">${{ "%.2f"|format(car.weekly_rate) }}</span>
                        </div>
                        {% endif %}
                        {% if car.monthly_rate %}
                        <div class="price-item">
                            <span class="price-label">Monthly Rate:</span>
                            <span class="price-value">${{ "%.2f"|format(car.monthly_rate) }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <hr>
                    
                    <div class="additional-fees">
                        <h6>Additional Options:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-user-tie"></i> Driver: +$50/day</li>
                            <li><i class="fas fa-shield-alt"></i> Insurance: +$15/day</li>
                            <li><i class="fas fa-map-marked-alt"></i> GPS: +$10/day</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Status Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h4>Availability</h4>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        {% if car.is_available %}
                        <div class="status-indicator available">
                            <i class="fas fa-check-circle fa-3x text-success"></i>
                            <h5 class="mt-2 text-success">Available</h5>
                            <p class="text-muted">Ready for booking</p>
                        </div>
                        {% else %}
                        <div class="status-indicator unavailable">
                            <i class="fas fa-times-circle fa-3x text-danger"></i>
                            <h5 class="mt-2 text-danger">Not Available</h5>
                            <p class="text-muted">Currently {{ car.status.value }}</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            Status: <span class="badge badge-{{ car.status_badge }}">{{ car.status.value }}</span>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card">
                <div class="card-body">
                    {% if car.is_available and current_user.is_authenticated %}
                    <a href="{{ url_for('bookings.create', car_id=car.id) }}" 
                       class="btn btn-primary btn-block btn-lg mb-3">
                        <i class="fas fa-calendar-check"></i> Book Now
                    </a>
                    {% elif not current_user.is_authenticated %}
                    <a href="{{ url_for('auth.login') }}" 
                       class="btn btn-primary btn-block btn-lg mb-3">
                        <i class="fas fa-sign-in-alt"></i> Login to Book
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('cars.index') }}" class="btn btn-outline-secondary btn-block">
                        <i class="fas fa-arrow-left"></i> Back to Fleet
                    </a>
                    
                    {% if current_user.is_authenticated and current_user.is_manager %}
                    <hr>
                    <h6>Admin Actions</h6>
                    <a href="{{ url_for('cars.edit', id=car.id) }}" class="btn btn-warning btn-block mb-2">
                        <i class="fas fa-edit"></i> Edit Car
                    </a>
                    {% if car.is_active %}
                    <form method="POST" action="{{ url_for('cars.delete', id=car.id) }}" 
                          onsubmit="return confirm('Are you sure you want to remove this car from the fleet?');">
                        <button type="submit" class="btn btn-danger btn-block">
                            <i class="fas fa-trash"></i> Remove from Fleet
                        </button>
                    </form>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.placeholder-image {
    text-align: center;
    padding: 60px 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.price-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.price-label {
    font-weight: 500;
    color: #666;
}

.price-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #007bff;
}

.features-list {
    margin-top: 10px;
}

.status-indicator {
    padding: 20px;
}

.additional-fees li {
    padding: 5px 0;
}
</style>
{% endblock %}